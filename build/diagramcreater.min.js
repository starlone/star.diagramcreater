function DragArea(t){var e=this;this.selector=t.selector||".drag-area",this.element=$(this.selector),this.children={},this.m_pos={x:0,y:0},this.element.mousemove(function(t){e.m_pos.x=t.pageX,e.m_pos.y=t.pageY})}function Entity(t){this.name=t.name||"Entity",this.columns=[]}function EntityMDL(t){this.containment=t.containment||".drag-area";var e=t.name||"Entity";this.entity=new Entity({name:e}),this.element=$("<div />"),this.element.attr("class","entity draggable mdl-card mdl-shadow--2dp");var n=$(".entity").length+1,i=$('<div class="mdl-card__title" />'),o=$('<h2 class="entity-title mdl-card__title-text" />').html(this.entity.name);i.append(o);var a=$('<div class="pbuttons mdl-card__menu" >'),r=$('<button class="bclose mdl-button mdl-button--icon mdl-js-button mdl-js-ripple-effect" />');r.append($('<i class="material-icons" />').text("delete")),a.append(r);var s=$('<table class="mdl-card__supporting-text mdl-data-table mdl-js-data-table" />'),l=$("<tbody />");s.append(l),this.element.attr("id","entity-"+n),this.element.append(i).append(s).append(a),this.newColumn("id","SERIAL"),this.newColumn("name","CHAR"),this.element.draggable({containment:this.containment,cursor:"move",scroll:!0,stack:".draggable"})}function Column(t,e){this.name=t,this.type=e}DragArea.prototype.addChild=function(t){this.children[t.getId()]=t,this.element.append(t.getElement())},DragArea.prototype.newEntity=function(t){var e=this,n=new EntityMDL({containment:this.selector});return this.addChild(n),n.setPosition(this.calcMousePosition()),n.getElement().find("button.bclose").click(function(t){t.preventDefault();var n=$(this).parents(".entity").attr("id");e.rmChild(n)}),n},DragArea.prototype.calcMousePosition=function(){var t=this.element.position();return{left:this.m_pos.x-t.left,top:this.m_pos.y-t.top}},DragArea.prototype.getChild=function(t){return this.children[t]},DragArea.prototype.getChildren=function(){return this.children},DragArea.prototype.rmChild=function(t){var e=this.getChild(t);e.element.remove(),delete this.children[t]},Entity.prototype.newColumn=function(t,e){var n=new Column(t,e);this.columns.push(n)},EntityMDL.prototype.getElement=function(){return this.element},EntityMDL.prototype.getId=function(){return this.element.attr("id")},EntityMDL.prototype.setName=function(t){t&&(this.entity.name=t,this.element.find(".entity-title").html(t))},EntityMDL.prototype.setPosition=function(t){var e=this.element.position(),n=$(this.containment).position(),i=n.top-e.top+t.top,o=n.left-e.left+t.left;this.element.css("top",i).css("left",o)},EntityMDL.prototype.getSQL=function(){var t="CREATE TABLE ";t+=this.entity.name,t+="\n{\n    ";var e=[];for(var n in this.entity.columns){var i=this.entity.columns[n];e.push(i.getSQL())}return t+=e.join(",\n    "),t+="\n};\n"},EntityMDL.prototype.newColumn=function(t,e){this.entity.newColumn(t,e);var n=$("<tr />"),i=$("<td />").html(t),o=$("<td />").html(e);this.element.find("tbody").append(n),n.append(i).append(o)},Column.prototype.getSQL=function(){return this.name+" "+this.type},$(function(){var t=new DragArea({selector:".drag-area"});$(".drag-area").click(function(e){var n=($(this),$(".buttons-box :radio:checked"));if(n.length&&"entity"==n.val()){var i=t.newEntity();document.querySelector("#modal-entity").showModal(),$("input[type=hidden][name=id_entity]").val(i.getId()),$(".form-entity input#entity-name").val(""),$(".buttons-box :radio[value=move]").click()}}),$(".buttons-box :radio").change(function(){var t=$(this).val();"move"==t?$(".drag-area").css("cursor",""):"entity"==t&&$(".drag-area").css("cursor","crosshair")}),$("form.form-entity").submit(function(e){e.preventDefault();var n=$(this),i=n.find("input[name=id_entity]").val(),o=t.getChild(i),a=n.find("input#entity-name").val();o.setName(a),document.querySelector("#modal-entity").close()}),$(".build_sql").click(function(e){e.preventDefault();var n="",i=t.getChildren();for(var o in i){var a=i[o];n+=a.getSQL()}var r=$("#modal-sql");r.find("code").html(n),r[0].showModal()}),$("dialog .close").click(function(){$(this).parents("dialog")[0].close()}),$(".buttons-box").buttonset()});